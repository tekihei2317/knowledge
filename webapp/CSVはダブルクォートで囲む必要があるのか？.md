# CSVはダブルクォートで囲む必要があるのか？

PHPの`fputcsv`を使うと、空白がある場合だけダブルクォートで囲まれるようになっていた。そのため、空白が存在しない数値などのデータもダブルクォートで囲む必要があるのか気になったので、調べてみることにした。

## ダブルクォートで囲まなかったときに起こる現象

ダブルクォートで囲んでいない場合、0から始まる文字列が数値とみなされていて、表計算ソフト(Numbers)では先頭の0が除外されていた。

また、スプレッドシートの場合は先頭の0が表示されるように、'（シングルクォート）でエスケープされていた。

スプレッドシートで数値、日付に変換するオプションを付けた場合、インポートする際に先頭の0が除外されていた。

```text
元のCSV

09012345678

表計算ソフトでの表示(Numbers)

9012345678

Googleスプレッドシートでのセルのデータ（変換オプションなし）

'9012345678

Googleスプレッドシートでのセルのデータ（変換オプションあり）

9012345678
```

数値だけからなるデータは、ダブルクォートで囲まなければ数値としてみなされるみたい。なので、基本的に文字列のデータにはダブルクォートをつけるべきだと思われる。

## 数値データにもダブルクォートをつけるべきか？

基本的に全部ダブルクォートで囲めば良さそう。表計算ソフトが、ダブルクォートの中身の型を判定することが出来ればこれで問題ない。

### スプレッドシートにアップロードする場合

変換オプションを付けた場合、"314159"→314159のように変換される。変換オプションを付けなかった場合は、数値からなる文字列が数値データにならないように、"314159"→'314159のようにシングルクォートでエスケープされる。

考えるのが面倒なので、全部ダブルクォートで囲むことにする。この場合の問題点は、数値として扱いたいデータが文字列として扱われることがあること。スプレッドシートの場合は先述の変換オプションをつければ対応できる。他の表計算ソフトでも同様のことが出来ると思うことにする。

## ダブルクォートで囲む場合の注意点

文字列中にダブルクォートが含まれる場合はエスケープする必要がある。エスケープをするにはダブルクォートを2つ重ねる。\（バッククォート）でエスケープする方法もあるみたいだが、こちらは普及していないので利用を避けるべきみたい。

## まとめ

問題が起きたときに学んで対応していくスタイル。

## 参考

- [CSVファイルフォーマットの解説：CodeZine（コードジン）](https://codezine.jp/article/detail/2364)
- [【PHP】csvを自前で作った話 | ダブルコーテーション問題でfputcsvは使わず実装 - Qiita](https://qiita.com/non0311/items/b812aff80213f627d36b)
