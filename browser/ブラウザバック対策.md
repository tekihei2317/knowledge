# ブラウザバック対策

## 問題点

戻るボタンを使うと、バックエンドでアクセス出来ないようにしている画面にもアクセス出来てしまう（キャッシュがあるのでリクエストが送られない）。

例えば抽選アプリで、抽選を実行して抽選画面から抽選結果画面にリダイレクトした後、戻るボタンを押すともう一度抽選が出来るようになってしまう。

## 対策方法

戻るボタン自体を無効化する
ブラウザの挙動を変えるのはあまり良くない気がする

### 戻るボタンを押したときにもリクエストが送られるようにする(→結果画面に再度リダイレクトさせる)

これもブラウザがおかしくなるような気もする。

レスポンスヘッダに`Cache-Control: no-cache`をつけてみると、戻るボタンを押したときもリクエストが送られるようになって、結果画面にリダイレクトされた。

ブラウザの履歴は`A → B`から、`B → B`に変わっていた（A: 抽選画面、B: 結果画面）。戻るボタンを押したときにリダイレクトすると、履歴が書き換わるみたい。これはブラウザによって変わるような気もする。

### 2回目の抽選だった場合、別のページにリダイレクトするようにする

例えば抽選のアニメーションが長かった場合は、アニメーションが実行されてからリダイレクトすることになりそう。

### ルーレットページを抽選済み画面に書き換えてから、結果画面にリダイレクトする

出来るならこれが良さそう。

## 参考

- [ブラウザの「戻る」ボタンでキャッシュが表示されてしまう際の対策 - Qiita](https://qiita.com/shibe23/items/79f950061457ff1a7687)
