# ドメイン駆動設計入門

インメモリデータベースの重要性とは？

テスト環境だけ使うとか？本番環境と差異が出ないほうが良いとは思うけど（部分的に生のSQLを書いたりした場合を考えて）、それを上回るメリットがあるということ？

## 7章 依存関係

### そもそも依存とは？

あるクラスAが、クラスBが存在しないと動作しない場合、クラスAはクラスBに依存しているという。例えばクラスAの中でクラスBをインスタンス化している場合は、クラスBを消すとクラスAが動かなくなるので依存している。

逆にクラスAのメソッドの引数で、クラスBのインターフェイスを受け取るようにする（？）と、クラスAはクラスBに依存しなくなる（クラスBがなくなったとしても、クラスBと同じインターフェイスを持つクラスCが使えるため）。

### 依存関係逆転の法則とは？

使う側（上位のモジュール）と使われる側（下位のモジュール）の間にインターフェイスを挟んで、どちらも抽象に依存するようにすること。

上位のモジュール、下位のモジュールというのは、目的を達成するための手段としてどれくらい具体的かということ。

### なぜそうするんだろう？

下位のモジュールを入れ替えられるようにするため？
下位のモジュールの実体に依存していたとしても、単に実体のメソッドを呼び出しているだけだったら入れ替えは簡単だと思う（これはインターフェイスを持たない言語の抽象（ダック）？）

### 理想はすべての依存の間にインターフェイスを挟むこと？

もし手間が0なのであればそうするのかな。

依存の度合いについての例えで「お客が厨房の中に入って調理をしないようにする」というのがある。これは料理を食べるという目的があって、それを達成するために厨房のなかに入って料理をするのではなく、メニューから頼んでシェフに作ってもらうということ。

### どのようにして実態の切り替えを実装するか？

Service Locatorパターンと、IoCコンテナパターンの2つの方法がある。

Service Locatorパターンは、`ServiceLocator.register(interface, class)`のように、事前に対応を定義しておく。IoCコンテナパターンは、メソッドの引数がクラスのときに引数を渡さなくてもインスタンス化してくれる？

言語機能としてのインターフェイスをまだ理解していない。

## 4章 ドメインサービス

ビジネスロジック（表示とデータアクセス以外）のうち、登場人物を表すクラスで表現できないものを表現するためのクラスをドメインサービスという。

具体的には、ユーザーのメールアドレスの重複チェックをするとき、それをユーザークラスのインスタンスに問い合わせるのは違和感がある（すべてのユーザーに関する処理を、特定のユーザーが行っているため）。

```ruby
user = User.new(name: 'name')
user.exists('new name')
```

この違和感をなくすために別のクラスを作成する（staticメソッド使ったらいいかなと思ったけど良くないのだろうか？）。

```ruby
user_service = UserService.new
user_service.exists('new name')
```

## 参考

- [「ビジネスロジック」とは何か、どう実装するのか - Qiita](https://qiita.com/os1ma/items/25725edfe3c2af93d735)
